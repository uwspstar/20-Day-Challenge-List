### 学习如何创建 Container 图

**Container 图**是 C4 模型的第二层视图，它展示了系统内部的主要容器（如 Web 应用、数据库、微服务等）及其交互关系。Container 图帮助架构师和开发者理解系统的架构和各个主要构件的职责。

---

### 创建 Container 图的步骤

#### 1. **识别系统的主要容器**
- **容器的定义**：容器代表在系统中运行的应用程序或存储数据的单元。每个容器都有明确的职责，可能是一个应用服务器、数据库、微服务或外部系统的代理。
  
- **典型容器类型**：
  - **Web 应用**：负责与用户交互的部分。
  - **API 网关**：处理客户端请求并路由到后台服务。
  - **数据库**：存储数据的容器。
  - **微服务**：在微服务架构中，每个微服务通常是一个独立的容器。

**示例**：
- 对于一个电子商务平台，主要的容器可能包括：
  - Web 应用（前端）。
  - 订单服务（微服务）。
  - 支付服务（微服务）。
  - 数据库（存储订单、用户信息等）。

---

#### 2. **标识容器之间的交互关系**
- **容器之间的通信**：确定各个容器如何相互交互，例如 Web 应用通过 API 调用订单服务，订单服务查询数据库等。使用箭头表示容器间的请求和响应。

- **交互类型**：
  - **同步通信**：如 REST API 调用。
  - **异步通信**：如消息队列、事件驱动等。
  
**示例**：
- 电子商务平台中的 Web 应用可能通过 REST API 与订单服务和支付服务进行通信，而订单服务会与数据库交互以存储订单信息。

---

#### 3. **绘制容器及其交互**
- **容器表示法**：
  - 使用矩形表示每个容器，矩形内标注容器的名称及其主要职责。
  
- **交互表示法**：
  - 使用箭头表示容器之间的交互，箭头旁边标注交互内容（如“API 调用”、“数据库查询”等）。

**示例**：
- 一个电子商务平台的 Container 图可以这样表示：
```
(用户浏览器) ---> [Web 应用] ---> [订单服务] ---> [数据库]
                           |               |
                           |               |
                       [支付服务]       [物流服务]
```

- **解释**：
  - 用户浏览器访问 Web 应用，Web 应用调用订单服务。
  - 订单服务处理订单并查询数据库存储订单信息。
  - 支付服务负责订单的支付，物流服务负责订单的发货。

---

#### 4. **标注容器的职责**
- 在每个容器的矩形框中标注其职责和关键技术栈，帮助理解每个容器的功能和技术实现。

**示例**：
- 在电子商务平台中，可以为每个容器标注如下职责：
  - **Web 应用**：展示前端页面，处理用户交互，使用 React。
  - **订单服务**：处理订单的创建与管理，使用 Python + Flask。
  - **支付服务**：处理支付事务，使用 Java + Spring。
  - **数据库**：存储订单和用户数据，使用 MySQL。

---

#### 5. **定义外部依赖**
- **外部系统**：如果有外部系统（如支付网关、消息队列等），也要将其显示为一个容器，展示系统如何与外部系统交互。

**示例**：
- 如果电子商务平台使用了第三方支付服务，可以在 Container 图中表示支付服务与外部支付网关之间的交互。

---

### Container 图的最佳实践

1. **保持容器职责的清晰**：
   - 每个容器应当有明确的职责，避免职责模糊或过多的容器。
   - 标注每个容器的主要功能，使读者能够快速理解容器的作用。

2. **避免技术细节过多**：
   - Container 图应着眼于系统的高层次结构，避免展示技术实现的细节，如具体类、方法等。这些细节可以在 Component 图中进一步细化。

3. **使用标准符号**：
   - 确保所有容器和交互使用一致的图形和箭头样式，确保图表易于理解。

4. **标注交互内容**：
   - 在容器之间的箭头上标注交互内容，帮助读者了解容器之间传递了什么信息或服务请求。

5. **考虑不同交互方式**：
   - 标注同步与异步交互，如 API 调用、消息队列等不同的交互模式，明确系统的通信方式。

---

### 示例：电子商务平台的 Container 图

```
(用户浏览器) ---> [Web 应用]
                    |
             --------------------------------
            |                                |
         [订单服务]                       [支付服务]
            |                                |
          [数据库]                        [支付网关]
            |
          [物流服务]
```

#### 解释：
- **Web 应用**：用户通过浏览器访问前端 Web 应用，查看商品并提交订单。
- **订单服务**：Web 应用与订单服务交互，处理订单的创建、修改和查询。
- **支付服务**：订单服务与支付服务交互，处理订单的支付过程。
- **数据库**：订单服务与数据库交互，存储和读取订单、用户等数据。
- **支付网关**：支付服务与外部支付网关交互，处理支付请求。
- **物流服务**：订单完成后，物流服务处理订单的发货与配送。

---

### 小结

Container 图通过展示系统中的主要容器及其交互，帮助架构师和开发者理解系统的整体架构和各部分的职责。通过明确的容器划分和交互关系，团队成员可以快速了解系统的组成部分和工作流程，是沟通架构设计和系统实现的有效工具。

**提示**：
- 保持图表简洁，避免过多容器或复杂交互。
- 明确容器的职责，使用直观的箭头展示容器之间的关系。
